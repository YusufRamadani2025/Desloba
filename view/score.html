<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DesLoba</title>
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <link rel="icon" type="image/x-icon" href="../assets/images/logoDesloba.png">
    <link rel="stylesheet" href="../view/css/score.css">
</head>
<body>
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Sidebar -->
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <button class="close-btn" id="closeSidebar">&times;</button>
        <div class="sidebar-menu">
            <a href="../index.html">Home</a>
            <a href="../view/sound.html">Sound</a>
            <a href="../view/score.html">Score</a>
            <a href="../view/contact.html" class="contact-button">Contact</a> 
        </div>
    </aside>
    
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-logo">
            <img src="../assets/images/logoDesloba.png" alt="Logo DesLoba" />
            <h1>DesLoba</h1>
        </div>
        <div class="navbar-menu">
            <a href="../index.html">Home</a>
            <a href="../view/sound.html">Sound</a>
            <a href="../view/score.html">Score</a>
            <a href="../view/contact.html" class="contact-button">Contact</a> 
        </div>
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </nav>
    
    <!-- Slider -->
    <main>
        <div class="container">
            <h1>Scoreboard DesLoba</h1>
            
            <div class="input-container">
                <h3>Fill the team name and start!</h3>
                <div class="team-input">
                    <div class="input-group">
                        <label for="team1">Team 1 Name:</label>
                        <input type="text" id="team1" placeholder="Enter name">
                    </div>
                    <div class="input-group">
                        <label for="team2">Team 2 Name:</label>
                        <input type="text" id="team2" placeholder="Enter name">
                    </div>
                </div>
                <button onclick="startGame()">Start Game</button>
            </div>
            
            <div class="score-container" style="display: none;">
                <!-- ‚è±Ô∏è TIMER SECTION -->
                <div class="timer-section">
                    <div id="timer-display">10:00</div>
                    <div class="timer-controls">
                        <button id="decrease-time">-1 min</button>
                        <button id="start-timer">Start Timer</button>
                        <button id="increase-time">+1 min</button>
                        <button id="reset-timer">Reset Timer</button> 
                    </div>
                </div>
                
                <!-- Skor seperti desain awal -->
                <div class="score-board">
                    <!-- Fouls Team 1 -->
                    <div class="fouls-block team-1-fouls">
                        <div class="fouls-label">Fouls</div>
                        <div id="team1Fouls">0</div>
                        <div class="fouls-buttons">
                            <button onclick="addFoul(-1, 'team1')">-1</button>
                            <button onclick="addFoul(1, 'team1')">+1</button>
                        </div>
                    </div>
                    
                    <!-- Team 1 (utama) -->
                    <div class="team-block team-1">
                        <h1 id="team1Name">Team 1</h1>
                        <div id="team1Score">0</div>
                        <div class="buttons">
                            <button onclick="addScore(-1, 'team1')">-1</button>
                            <button onclick="addScore(1, 'team1')">+1</button>
                            <button onclick="addScore(2, 'team1')">+2</button>
                            <button onclick="addScore(3, 'team1')">+3</button>
                        </div>
                    </div>
                    
                    <!-- Team 2 (utama) -->
                    <div class="team-block team-2">
                        <h1 id="team2Name">Team 2</h1>
                        <div id="team2Score">0</div>
                        <div class="buttons">
                            <button onclick="addScore(-1, 'team2')">-1</button>
                            <button onclick="addScore(1, 'team2')">+1</button>
                            <button onclick="addScore(2, 'team2')">+2</button>
                            <button onclick="addScore(3, 'team2')">+3</button>
                        </div>
                    </div>
                    
                    <!-- Fouls Team 2 -->
                    <div class="fouls-block team-2-fouls">
                        <div class="fouls-label">Fouls</div>
                        <div id="team2Fouls">0</div>
                        <div class="fouls-buttons">
                            <button onclick="addFoul(-1, 'team2')">-1</button>
                            <button onclick="addFoul(1, 'team2')">+1</button>
                        </div>
                    </div>
                </div>
                
                <button onclick="resetScore()">Reset Score</button>
                <button onclick="resetGame()">Reset Game</button>
            </div>
        </div>
    </main>
    
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        // Sidebar toggle
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const hamburger = document.getElementById('hamburger');
        const closeBtn = document.getElementById('closeSidebar');
        
        hamburger.addEventListener('click', () => {
            sidebar.classList.add('active');
            overlay.classList.add('active');
        });
        
        [closeBtn, overlay].forEach(el => {
            el.addEventListener('click', () => {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            });
        });
        
        let timeLeft = 10 * 60; // 600 detik = 10 menit
        let timerInterval = null;
        let isTimerRunning = false;
        
        // ===== LOCAL STORAGE KEY =====
        const STORAGE_KEY = 'desloba_scoreboard_data';
        
        // ===== SIMPAN DATA KE LOCAL STORAGE =====
        function saveGameState() {
            const data = {
                team1Name: document.getElementById('team1Name').textContent,
                team2Name: document.getElementById('team2Name').textContent,
                team1Score: document.getElementById('team1Score').textContent,
                team2Score: document.getElementById('team2Score').textContent,
                team1Fouls: document.getElementById('team1Fouls').textContent,
                team2Fouls: document.getElementById('team2Fouls').textContent,
                timeLeft: timeLeft,
                isTimerRunning: isTimerRunning // ‚úÖ tambahkan ini
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }
        
        // ===== MUAT DATA SAAT HALAMAN DIBUKA =====
        function loadGameState() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    
                    // Isi nilai
                    document.getElementById('team1Name').textContent = data.team1Name;
                    document.getElementById('team2Name').textContent = data.team2Name;
                    document.getElementById('team1Score').textContent = data.team1Score;
                    document.getElementById('team2Score').textContent = data.team2Score;
                    document.getElementById('team1Fouls').textContent = data.team1Fouls;
                    document.getElementById('team2Fouls').textContent = data.team2Fouls;
                    
                    // ‚úÖ Gunakan timeLeft dari localStorage, jangan reset ke 600
                    timeLeft = data.timeLeft || 600;
                    isTimerRunning = data.isTimerRunning || false; // opsional
                    
                    updateTimerDisplay();
                    
                    // Tampilkan scoreboard
                    document.querySelector('.input-container').style.display = 'none';
                    document.querySelector('.score-container').style.display = 'block';
                    
                    // Jangan jalankan timer otomatis ‚Äî biarkan user klik "Start Timer"
                    document.getElementById('start-timer').textContent = isTimerRunning ? "Pause" : "Start Timer";
                    
                    return true;
                } catch (e) {
                    console.warn("Data localStorage rusak:", e);
                }
            }
            return false;
        }
        
        // ===== HAPUS DATA =====
        function clearGameState() {
            localStorage.removeItem(STORAGE_KEY);
        }
        
        // ===== FUNGSI TIMER (tidak berubah) =====
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }
        
        function updateTimerDisplay() {
            const display = document.getElementById('timer-display');
            if (display) display.textContent = formatTime(timeLeft);
        }
        
        function playTimeUpSound() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                oscillator.frequency.value = 800;
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0.3, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                oscillator.start(ctx.currentTime);
                oscillator.stop(ctx.currentTime + 0.5);
            } catch (e) {
                console.warn("Audio tidak didukung");
            }
        }
        
        function startTimer() {
            if (isTimerRunning) return;
            if (timeLeft <= 0) return;
            
            isTimerRunning = true;
            document.getElementById('start-timer').textContent = "Pause";
            
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                }
                if (timeLeft === 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    document.getElementById('start-timer').textContent = "Start Timer";
                    playTimeUpSound();
                    alert("‚è∞ Waktu Habis!");
                }
            }, 1000);
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
            isTimerRunning = false;
            document.getElementById('start-timer').textContent = "Start Timer";
        }
        
        function resetTimer() {
            pauseTimer();
            timeLeft = 10 * 60; // kembali ke 10 menit
            updateTimerDisplay();
            document.getElementById('start-timer').textContent = "Start Timer";
            saveGameState(); // ‚úÖ simpan perubahan
        }
        
        function toggleTimer() {
            if (isTimerRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }
        
        // üëá Fungsi utama saat klik "Start Game"
        function startGame() {
            const team1 = document.getElementById('team1').value.trim();
            const team2 = document.getElementById('team2').value.trim();
            
            if (!team1 || !team2) {
                alert("Please enter both team names!");
                return;
            }
            
            document.getElementById('team1Name').textContent = team1;
            document.getElementById('team2Name').textContent = team2;
            document.getElementById('team1Score').textContent = '0';
            document.getElementById('team2Score').textContent = '0';
            document.getElementById('team1Fouls').textContent = '0';
            document.getElementById('team2Fouls').textContent = '0';
            
            // ‚úÖ Reset timer hanya saat mulai game baru
            timeLeft = 10 * 60;
            isTimerRunning = false;
            updateTimerDisplay();
            document.getElementById('start-timer').textContent = "Start Timer";
            pauseTimer();
            
            document.querySelector('.input-container').style.display = 'none';
            document.querySelector('.score-container').style.display = 'block';
            
            saveGameState(); // Simpan dengan timeLeft = 600
        }
        
        function resetScore() {
            document.getElementById('team1Score').textContent = '0';
            document.getElementById('team2Score').textContent = '0';
            saveGameState(); // Simpan perubahan
        }
        
        function resetGame() {
            // Hentikan timer
            pauseTimer();
            
            // Reset waktu
            timeLeft = 10 * 60;
            updateTimerDisplay();
            
            // Reset skor & fouls
            document.getElementById('team1Score').textContent = '0';
            document.getElementById('team2Score').textContent = '0';
            document.getElementById('team1Fouls').textContent = '0';
            document.getElementById('team2Fouls').textContent = '0';
            
            // Sembunyikan score container
            document.querySelector('.score-container').style.display = 'none';
            
            // Tampilkan input container
            document.querySelector('.input-container').style.display = 'flex';
            
            // Kosongkan input
            document.getElementById('team1').value = '';
            document.getElementById('team2').value = '';
            
            // Reset tombol timer
            document.getElementById('start-timer').textContent = "Start Timer";
            
            // Hapus data
            clearGameState();
        }
        
        function addScore(points, team) {
            const elem = document.getElementById(team + 'Score');
            let current = parseInt(elem.textContent) || 0;
            elem.textContent = current + points;
            saveGameState(); // Simpan setiap perubahan
        }
        
        function addFoul(value, team) {
            const elem = document.getElementById(team + 'Fouls');
            let current = parseInt(elem.textContent) || 0;
            let newValue = current + value;
            if (newValue < 0) newValue = 0;
            elem.textContent = newValue;
            saveGameState(); // Simpan setiap perubahan
        }
        
        // Event delegation untuk tombol timer
        document.addEventListener('click', function(e) {
            if (e.target.id === 'decrease-time') {
                if (isTimerRunning) pauseTimer();
                timeLeft = Math.max(60, timeLeft - 60);
                updateTimerDisplay();
                saveGameState(); // Simpan
            } else if (e.target.id === 'increase-time') {
                if (isTimerRunning) pauseTimer();
                timeLeft += 60;
                updateTimerDisplay();
                saveGameState(); // Simpan
            } else if (e.target.id === 'start-timer') {
                toggleTimer();
            } else if (e.target.id === 'reset-timer') {
                resetTimer();
            }  
        });
        
        // üëá MUAT DATA SAAT HALAMAN DIBUKA
        window.addEventListener('DOMContentLoaded', function() {
            const hasData = loadGameState();
            if (!hasData) {
                // Pastikan form ditampilkan jika tidak ada data
                document.querySelector('.input-container').style.display = 'flex';
                document.querySelector('.score-container').style.display = 'none';
            }
        });
    </script>
</body>
</html>